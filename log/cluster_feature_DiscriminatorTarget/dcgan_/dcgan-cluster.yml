dir: &dir log/cluster_feature
n_steps: &n_steps 3000
every: &every 25
seed:
device: &device cuda
total_n: &total_n 1000
batch_size: &batch_size 1000
weight_step: &weight_step 0.1
step_size: &step_size 0.01
name: &name dcgan_cluster
burn_in_steps: 0
start_sample: 0
sub_dir: &sub_dir dcgan
distribution: &target_distribution
  name: DiscriminatorTarget
gan_config:
  dp: true
  dataset: cifar10
  train_transform:
    Normalize:
      mean: &mean [0.5, 0.5, 0.5]
      std: &std [0.5, 0.5, 0.5]
  prior: normal
  eval: true
  generator:
    name: DCGANGenerator
    params:
      ngpu: 1
      mean: *mean
      std: *std
    ckpt_path: checkpoints/dcgan/DCGAN_G_CIFAR_199.pth
  discriminator:
    name: DCGANDiscriminator
    params:
      ngpu: 1
      mean: *mean
      std: *std
    ckpt_path: checkpoints/dcgan/DCGAN_D_CIFAR_199.pth
  thermalize:
    true: {}
    false:
      log_norm_const: 0.21158193327342437
      lipschitz_const: 15.621315625
      fake_score: -4.945679950714111
      real_score: &real_score -0.43365247461013495
      mean_score: -2.689666212662123
sample_params: &sample_params
  sample: true
  save_dir: *dir
  sub_dir: *sub_dir
  distribution:
    <<: *target_distribution
  feature:
    name: ClusterFeature
    params:
      device: *device
      clusters_path: data/cifar10/kmeans.npz
      ref_stats_path: stats/ClusterFeature_cifar10.npz
  total_n: *total_n
  batch_size: *batch_size
  save_every: *every
  params:
    n_steps: *n_steps
    save_every: *every
    burn_in_steps: 0
    start_sample: 0
    n_sampling_steps: &n_sampling_steps 1
    weight_step: *weight_step
    step_size: *step_size
afterall_params:
  results_dir: *dir
  sub_dir: *sub_dir
  init_wandb: true
  compute_fid: true
  compute_is: true
params: &params
  sample_params: *sample_params
  name: *name
  feature:
    name: discriminator
wandb_init_params: &wandb_init_params
  project: &wandb_project soul_gan
  entity: &wandb_account sverdoot
  name: *name
  config: *params
logging:
  wandb:
callbacks:
  feature_callbacks:
    log_weight:
      name: LogCallback
      params:
        invoke_every: *every
        keys:
        - weight_norm
        save_dir:
    log_out:
      name: LogCallback
      params:
        invoke_every: *every
        keys:
        - out
        save_dir:
    log_ref:
      name: LogCallback
      params:
        invoke_every: *every
        keys:
        - ref_score
        save_dir:
    log_res:
      name: LogCallback
      params:
        invoke_every: *every
        keys:
        - residual
        save_dir:
  afterall_callbacks:
    energy:
      name: EnergyCallback
      params:
        dis:
        gen:
        invoke_every: 1
        device: *device
        update_input: true
        batch_size: *batch_size
        norm_constant:
    discriminator:
      name: DiscriminatorCallback
      params:
        dis:
        invoke_every: 1
        device: *device
        update_input: true
        batch_size: *batch_size
    wandb:
      name: WandbCallback
      params:
        init_params:
          <<: *wandb_init_params
          reinit: false
        invoke_every: 1
        keys:
        - Energy
        - D(G(z))
    wandb_imgs:
      name: WandbCallback
      params:
        init_params:
          <<: *wandb_init_params
          reinit: false
        invoke_every: 1
        keys:
        - imgs
